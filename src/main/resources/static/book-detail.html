<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
    <link rel="manifest" href="icon/site.webmanifest">
    <meta charset="UTF-8" />
    <title>Chi ti·∫øt s√°ch</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        img { max-width: 200px; }
    </style>
</head>
<body>
<header >
    <h1>Chi ti·∫øt s√°ch</h1>
    <a href="home.html"  class="cart-link">üè† Quay v·ªÅ trang ch·ªß</a>
</header>

<div id="bookDetailContainer">
    <!-- Th√¥ng tin s√°ch s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
</div>
<script type="module" src="/auth-utils.js"></script>
<script  type="module">
    const API_BASE = window.location.origin;
    const accessToken = localStorage.getItem("accessToken");

    function getBookIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get("bookId");
    }

    async function fetchBookDetail(bookId) {
        try {
            const res = await fetch(`${API_BASE}/book/${bookId}`, {
                headers: {
                    Authorization: `Bearer ${accessToken}`
                }
            });
            const result = await res.json();
            if (res.ok && result.success) {
                showBookDetail(result.data);
            } else {
                alert(result.message || "Kh√¥ng th·ªÉ l·∫•y chi ti·∫øt s√°ch");
            }
        } catch (err) {
            alert("L·ªói server: " + err.message);
        }
    }

    function showBookDetail(book) {
        const container = document.getElementById("bookDetailContainer");
        container.innerHTML = `
                <h2>${book.title}</h2>
                <img src="${book.imgUrl}" alt="${book.title}" />
                <p><b>T√°c gi·∫£:</b> ${book.author}</p>
                <p><b>Gi√°:</b> ${book.price.toLocaleString()} ‚Ç©</p>
                <p><b>M√¥ t·∫£:</b> ${book.description}</p>
                <p><b>Th·ªÉ lo·∫°i:</b> ${book.categoryName}</p>
                <p><b>Kho:</b> ${book.stock}</p>
            `;
    }

    window.onload = () => {
        const bookId = getBookIdFromUrl();
        if (!bookId) {
            alert("Kh√¥ng t√¨m th·∫•y ID s√°ch trong URL");
            return;
        }
        fetchBookDetail(bookId);
    }
</script>
</body>
</html>
